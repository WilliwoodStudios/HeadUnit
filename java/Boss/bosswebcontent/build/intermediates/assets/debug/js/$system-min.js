/* [Copyright (c) 2015 Workshop 12 Inc.] $system VERSION: 1.0.0.1105*/

function AudioManager(){var t={_private:{mediaSources:["tba"],currentMediaSource:null}};return t._private.createDelayedMediaSource=function(){return $system&&$system.config&&$system.config.isEmulator?new EmulatorPlayerMediaSource:new RemotePlayerMediaSource}.$bind(t),t._sounds={},$system.isClientDevice===!1&&(t._sounds.BLIP=new Audio("sounds/blip.mp3"),t._sounds.HORN=new Audio("sounds/horn.mp3"),t._sounds.TOUCH=new Audio("sounds/Touch.ogg"),t._sounds.TONE0=new Audio("sounds/tones/0.wav"),t._sounds.TONE1=new Audio("sounds/tones/1.wav"),t._sounds.TONE2=new Audio("sounds/tones/2.wav"),t._sounds.TONE3=new Audio("sounds/tones/3.wav"),t._sounds.TONE4=new Audio("sounds/tones/4.wav"),t._sounds.TONE5=new Audio("sounds/tones/5.wav"),t._sounds.TONE6=new Audio("sounds/tones/6.wav"),t._sounds.TONE7=new Audio("sounds/tones/7.wav"),t._sounds.TONE8=new Audio("sounds/tones/8.wav"),t._sounds.TONE9=new Audio("sounds/tones/9.wav"),t._sounds.TONE_POUND=new Audio("sounds/tones/p.wav"),t._sounds.TONE_ASTERIK=new Audio("sounds/tones/s.wav")),t.playSoundEffect=function(t){if("brainiacSystemSound"in window)return brainiacSystemSound.playSoundEffect(t),void 0;if($system.isClientDevice!==!0)switch(t){case $system.SoundEffect.BLIP:this._sounds.BLIP.play();break;case $system.SoundEffect.HORN:this._sounds.HORN.play();break;case $system.SoundEffect.TOUCH:this._sounds.TOUCH.play();break;case $system.SoundEffect.TONE0:this._sounds.TONE0.play();break;case $system.SoundEffect.TONE1:this._sounds.TONE1.play();break;case $system.SoundEffect.TONE2:this._sounds.TONE2.play();break;case $system.SoundEffect.TONE3:this._sounds.TONE3.play();break;case $system.SoundEffect.TONE4:this._sounds.TONE4.play();break;case $system.SoundEffect.TONE5:this._sounds.TONE5.play();break;case $system.SoundEffect.TONE6:this._sounds.TONE6.play();break;case $system.SoundEffect.TONE7:this._sounds.TONE7.play();break;case $system.SoundEffect.TONE8:this._sounds.TONE8.play();break;case $system.SoundEffect.TONE9:this._sounds.TONE9.play();break;case $system.SoundEffect.TONE_POUND:this._sounds.TONE_POUND.play();break;case $system.SoundEffect.TONE_ASTERIK:this._sounds.TONE_ASTERIK.play()}}.$bind(t),t.getMediaSources=function(){for(var t=0;this._private.mediaSources.length>t;++t)"tba"===this._private.mediaSources[t]&&(this._private.mediaSources[t]=this._private.createDelayedMediaSource());return this._private.mediaSources}.$bind(t),t.getActiveMediaSource=function(){return null===this._private.currentMediaSource&&(this.getMediaSources(),this._private.currentMediaSource=this._private.mediaSources[0]),this._private.currentMediaSource}.$bind(t),t}function ContactsManager(){var t={};return t.getContactList=function(t){$core._loadJSONFromUrl("data/data-contactList.json",t)}.$bind(t),t}function EmulatorPlayerMediaSource(){var t=new PlayerMediaSource;return t._private.player=new Audio,t._private.songHistory=new EmulatorSongHistory,$core._loadJSONFromUrl("data/data-mediaLibrary.json",function(t){this._populateLibrary(t),this.getSongs(function(t){this._private.songHistory.setPlaylist(t,0,!1)}.$bind(this))}.$bind(t)),t.playWithContext=function(e,i,s){var n=function(t){for(var i=0,s=0;t.length>s;++s)if(t[s].uid==e){i=s;break}this._private.songHistory.setPlaylist(t,i)}.$bind(this);if(void 0===i)t.getSongs(n);else if("genre"==i)t.getGenreSongs(s,n);else if("artist"==i)t.getArtistSongs(s,n);else if("album"==i)t.getAlbumSongs(s,n);else{if("playlist"!=i)throw"Unhandled playWithContext context: "+i;t.getPlaylistSongs(s,n)}}.$bind(t),t.skipForward=function(){this._private.songHistory.skipForward()}.$bind(t),t.skipBack=function(){this._private.songHistory.skipBack()}.$bind(t),t.pause=function(){1!=this._private.player.paused&&this._private.player.pause()}.$bind(t),t.play=function(){var t=this._private.player.src;void 0==t||""==t?this._private.songHistory.refreshCurrent():this._private.player.play()},t.isPaused=function(){return this._private.player.paused}.$bind(t),Object.defineProperty(t,"shuffle",{set:function(t){console.log("Write to shuffle: "+t),this._private.songHistory.shuffle=t}.$bind(t),get:function(){return console.log("Read of shuffle"),this._private.songHistory.shuffle}.$bind(t)}),Object.defineProperty(t,"repeat",{set:function(t){this._private.songHistory.repeat=t}.$bind(t),get:function(){return this._private.songHistory.repeat}}),t._private.onSongChanged=function(t){t&&t.data&&t.data.name&&t&&t.data&&t.data.triggerPlay&&(this._private.player.pause(),this._private.player.src=t.data.path?t.data.path:"",this._private.player.play(),setTimeout(function(){this._private.player.error&&this.skipForward()}.$bind(this),500))}.$bind(t),t._private.onEnded=function(){this._private.songHistory.moveForward(),setTimeout(function(){if(this._private.player.paused){var t=new $ui.DataEvent($system.EventType.MEDIA_PLAYBACK_ENDED,null);$ui.raiseEvent(t)}}.$bind(this),750)}.$bind(t),t._private.onPause=function(){setTimeout(function(){if(this._private.player.paused){var t=new $ui.DataEvent($system.EventType.MEDIA_PLAYBACK_ENDED,null);$ui.raiseEvent(t)}}.$bind(this),750)}.$bind(t),t._private.onPlay=function(){setTimeout(function(){if(!this._private.player.paused){var t=new $ui.DataEvent($system.EventType.MEDIA_PLAYBACK_STARTED,null);$ui.raiseEvent(t)}}.$bind(this),750)}.$bind(t),t.getStatus=function(){this._private.songHistory.getStatus()}.$bind(t),t.toggleShuffle=function(){var t=this._private.songHistory.shuffle;this._private.songHistory.shuffle=!t}.$bind(t),t.toggleRepeat=function(){this._private.songHistory.repeat=(this._private.songHistory.repeat+1)%3}.$bind(t),t.registerInterest=function(){this.getStatus()}.$bind(t),t.unregisterInterest=function(){}.$bind(t),$ui.addEventListener($system.EventType.MEDIA_SONG_CHANGED,t._private.onSongChanged),t._private.player.onended=t._private.onEnded,t._private.player.onpause=t._private.onPause,t._private.player.onplay=t._private.onPlay,t}function EmulatorSongHistory(){var t={REPEAT_NONE:0,REPEAT_ONE:1,REPEAT_ALL:2,_private:{repeat:0,shuffle:!1},history:[],future:[],playlist:[],playlistAt:0};return t._private.setCurrent=function(t,e){void 0==e&&(e=!0),null==t&&(t={});var i=$system.util.clone(t);if(i.triggerPlay=e,this.current=t,window.$core){var s=new $ui.DataEvent($system.EventType.MEDIA_SONG_CHANGED,i);$core.raiseEvent(s)}return t}.$bind(t),t.getStatus=function(){var t=this.current;null==t&&(t={});var e=$system.util.clone(t);if(e.triggerPlay=!1,window.$core){var i=new $ui.DataEvent($system.EventType.MEDIA_SONG_CHANGED,e);$core.raiseEvent(i),i=new $ui.DataEvent($system.EventType.MEDIA_REPEAT_CHANGED,this._private.repeat),$core.raiseEvent(i),i=new $ui.DataEvent($system.EventType.MEDIA_SHUFFLE_CHANGED,this._private.shuffle),$core.raiseEvent(i)}}.$bind(t),t.refreshCurrent=function(){this._private.setCurrent(this.getCurrent())}.$bind(t),Object.defineProperty(t,"shuffle",{set:function(t){if(t!==this._private.shuffle){if(this._private.shuffle=t===!0,0!=this.playlist.length){if(this._private.shuffle){for(var e=0;this.playlist.length>e;++e)this.playlist[e].rand=Math.random();this.playlist.sort(function(t,e){return t.rand-e.rand})}else this.playlist.sort(function(t,e){return t.ordinal-e.ordinal});this.playlistAt=0,this.future=[],this.skipForward()}if(window.$core){var i=new $ui.DataEvent($system.EventType.MEDIA_SHUFFLE_CHANGED,this._private.shuffle);$core.raiseEvent(i)}}}.$bind(t),get:function(){return this._private.shuffle}.$bind(t)}),Object.defineProperty(t,"repeat",{set:function(t){if("number"==typeof t&&t>=0&&2>=t&&t!=this._private.repeat&&(this._private.repeat=t,window.$core)){var e=new $ui.DataEvent($system.EventType.MEDIA_REPEAT_CHANGED,this._private.repeat);$core.raiseEvent(e)}}.$bind(t),get:function(){return this._private.repeat}}),t.skipBack=function(){var t=this.getCurrent();return 0==this.history.length?this._private.setCurrent(t):(this.isValid(t)&&this.future.push(t),this._private.setCurrent(this.history.pop()))}.$bind(t),t.getCurrent=function(t){return t||this.current?this.current:this.skipForward()}.$bind(t),t.nextSong=function(){}.$bind(t),t.isValid=function(t){return t&&t.uid&&t.uid.length>0?!0:!1}.$bind(t),t.moveForward=function(){var t=this.getCurrent();return this.repeat==this.REPEAT_ONE?(this._private.setCurrent(t),void 0):(this.skipForward(),void 0)}.$bind(t),t.skipForward=function(t){var e=this.getCurrent(!0);if(0==this.future.length&&!this.playListHasNext())return e;if(this.isValid(e)){var i=!0;if(0!=this.history.length){var s=this.history[this.history.length-1];s.uid===e.uid&&(i=!1)}i&&this.history.push(e)}return this.future.length>0?this._private.setCurrent(this.future.pop(),t):this._private.setCurrent(this.playListNext(),t)}.$bind(t),t.setPlaylist=function(t,e,i){this.history=[],this.future=[],this.playlist=[],this.playlistAt=0;for(var s=0;t.length>s;++s){var n=$system.util.clone(t[(e+s)%t.length]);n.ordinal=s,this.playlist.push(n)}this.skipForward(i)}.$bind(t),t.playListHasNext=function(){return 0==this.playlist.length?!1:this.repeat==this.REPEAT_ALL?!0:this.playlistAt<this.playlist.length}.$bind(t),t.playListNext=function(){return 0==this.playlist.length?null:(this.repeat==this.REPEAT_ALL&&(this.playlistAt%=this.playlist.length),this.playlistAt<this.playlist.length?this.playlist[this.playlistAt++]:null)}.$bind(t),t}function PhoneManager(){var t={};return t.getCallLog=function(t){$core._loadJSONFromUrl("data/data-call-list.json",t)},t.getCallLog=t.getCallLog.$bind(t),t}function PlayerMediaSource(){function t(t){return t=t.toUpperCase().trim(),t=t.replace(/^\'/g,""),t=t.replace(/^\"/g,"")}function e(e,i){return null==e&&null==i?0:null==e?1:null==i?-1:(e=t(e),i=t(i),i>e?-1:e>i?1:0)}function i(t,e){return null==t&&null==e?0:null==t?1:null==e?-1:t-e}var s={_private:{},uid:"media.source.player",name:"iPhone",type:$system.MediaSourceType.PLAYER};return s._populateLibrary=function(t){this._library=t,this._library.index={albums:{},songs:{},artists:{},genres:{},playlists:{}};var e,i;for(e=0;t.albums.length>e;e++)i=t.albums[e],this._library.index.albums[i.uid]=i;for(e=0;t.artists.length>e;e++)i=t.artists[e],this._library.index.artists[i.uid]=i;for(e=0;t.genres.length>e;e++)i=t.genres[e],this._library.index.genres[i.uid]=i;for(e=0;t.songs.length>e;e++)i=t.songs[e],this._library.index.songs[i.uid]=i;for(e=0;t.playlists.length>e;++e)i=t.playlists[e],this._library.index.playlists[i.uid]=i;this._library.artists.forEach(function(t){t.playCount=0,t.albumCount=0,t.songCount=0}),this._library.albums.forEach(function(t){t.playCount=0,t.songCount=0}),this._library.genres.forEach(function(t){t.artistCount=0,t.songCount=0,t.playCount=0}),this._library.playlists.forEach(function(t){t.artistCount=0});var s=this._library.index;this._library.songs.forEach(function(t){var e=s.albums[t.albumUid];e.playCount+=t.playCount,e.songCount++;var i=s.artists[e.artistUid];i.songCount++,i.playCount+=t.playCount;var n=s.genres[i.genreUid];n.songCount++,n.playCount+=t.playCount}),this._library.artists.forEach(function(t){var e=s.genres[t.genreUid];e.artistCount++}),this._library.albums.forEach(function(t){if(t.artwork&&t.artwork.length>0){var e=s.artists[t.artistUid];++e.albumCount,(null==e.artwork||0==e.artwork.length)&&(e.artwork=t.artwork)}}),this._library.playlists.forEach(function(t){if(t.duration||(t.duration=0),t.songCount||(t.songCount=0),t.playCount||(t.playCount=0),!t.artwork)for(var e=0;t.songs.length>e;++e){var i=t.songs[e],n=s.songs[i],r=s.albums[n.albumUid];t.songCount++,t.duration+=n.duration,t.playCount+=n.playCount,r.artwork&&!t.artwork&&(t.artwork=r.artwork)}})}.$bind(s),s.getGenreSongs=function(t,i){var n=[],r=this._library;this._library.artists.forEach(function(e){e.genreUid==t&&r.albums.forEach(function(i){i.artistUid==e.uid&&r.songs.forEach(function(r){if(r.albumUid==i.uid){var a=$system.util.clone(r);a.artistName=e.name,a.albumName=i.name,a.artwork=i.artwork,a.startPlaying=function(){s.playWithContext(a.uid,"genre",t)},n.push(a)}})})}),n.sort(function(t,i){var s=e(t.name,i.name);return 0===s&&(s=e(t.albumName,i.albumName)),s}),$system.util.callCallback(i,n)}.$bind(s),s.getSongs=function(t){var n=[],r=this._library;this._library.songs.forEach(function(t){var e=r.index.albums[t.albumUid],i=r.index.artists[e.artistUid],a=$system.util.clone(t);a.artistName=i.name,a.albumName=e.name,a.artwork=e.artwork,a.startPlaying=function(){s.playWithContext(a.uid)},n.push(a)}),n.sort(function(t,s){var n=e(t.artistName,s.artistName);return 0===n&&(n=e(t.albumName,s.albumName)),0===n&&(n=i(t.trackNumber,s.trackNumber)),0===n&&(n=e(t.name,s.name)),n}),$system.util.callCallback(t,n)}.$bind(s),s.getAlbumSongs=function(t,n){var r=[];if(this._library.index.albums[t]){var a=this._library.index.albums[t],o=this._library.index.artists[a.artistUid];this._library.songs.forEach(function(e){if(e.albumUid===t){var i=$system.util.clone(e);i.artwork=a.artwork,i.albumName=a.name,i.artistName=o.name,i.startPlaying=function(){s.playWithContext(i.uid,"album",a.uid)},r.push(i)}})}r.sort(function(t,s){var n=i(t.trackNumber,s.trackNumber);return 0==n&&(n=e(t.name,s.name)),n}),$system.util.callCallback(n,r)}.$bind(s),s.getArtistSongs=function(t,n){var r=[],a=this._library,o=this._library.index.artists[t];this._library.songs.forEach(function(e){var i=a.index.albums[e.albumUid];if(i.artistUid==t){var n=$system.util.clone(e);n.albumName=i.name,n.artistName=o.name,n.artwork=i.artwork,n.startPlaying=function(){s.playWithContext(n.uid,"artist",o.uid)},r.push(n)}}),r.sort(function(t,s){var n=e(t.albumName,s.albumName);return 0===n&&(n=i(t.trackNumber,s.trackNumber),0===n&&(n=e(t.name,s.name))),n}),$system.util.callCallback(n,r)}.$bind(s),s.getMostPlayedArtists=function(t){var e=this._library.artists.slice();e.sort(function(t,e){return t.name<e.name?-1:1}),e.length>4&&(e=$system.util.clone(e.slice(0,4))),$system.util.callCallback(t,e)}.$bind(s),s.getArtists=function(t){var e=$system.util.clone(this._library.artists);e.sort(function(t,e){return t.name.toLowerCase()<e.name.toLowerCase()?-1:1}),$system.util.callCallback(t,e)}.$bind(s),s.getGenres=function(t){var i=$system.util.clone(this._library.genres);i.sort(function(t,i){return e(t.name,i.name)}),$system.util.callCallback(t,i)}.$bind(s),s.getAlbums=function(t){var e,i,s,n,r,a,o=[];for(e=0;this._library.albums.length>e;e++)if(s=this._library.albums[e],r=this._library.index.artists[s.artistUid],n=$system.util.clone(s),n.artistName=r.name,n.genre=this._library.index.genres[r.genreUid].name,0!==o.length){for(i=0;o.length>i;i++)if(a=o[i],n.name!=a.name||n.uid!=a.uid){if(n.name.toLowerCase()<=a.name.toLowerCase()){o.splice(i,0,n);break}if(i+1==o.length){o.push(n);break}}}else o.push(n);$system.util.callCallback(t,o)}.$bind(s),s.getMostPlayedPlaylists=function(t){var e=$system.util.clone(this._library.playlists);e.sort(function(t,e){return-(t.playCount-e.playCount)}),e=e.slice(0,4),$system.util.callCallback(t,e)}.$bind(s),s.getPlaylists=function(t){var e=$system.util.clone(this._library.playlists);e.sort(function(t,e){return t.name<e.name?-1:t.name>e.name?1:0}),$system.util.callCallback(t,e)}.$bind(s),s.getPlaylistSongs=function(t,e){var i=[],n=this._library.index.playlists[t],r=this._library.index;n&&n.songs.forEach(function(e){var n=r.songs[e],a=r.albums[n.albumUid],o=r.artists[a.artistUid],u=$system.util.clone(n);u.artwork||(u.artwork=a.artwork),u.albumName=a.name,u.artistName=o.name,u.startPlaying=function(){s.playWithContext(u.uid,"playlist",t)},i.push(u)}),$system.util.callCallback(e,i)}.$bind(s),s.getMostPlayedAlbums=function(t){var e,i,s,n,r=[];for(e=0;4>e;e++)i=this._library.albums[e],n=this._library.index.artists[i.artistUid],s={uid:i.uid,name:i.name,year:i.year,artwork:i.artwork,artistName:n.name,genre:this._library.index.genres[n.genreUid].name},r.push(s);$system.util.callCallback(t,r)}.$bind(s),s.getCurrentSong=function(t){t(null)}.$bind(s),s.registerInterest=function(){}.$bind(s),s.unregisterInterest=function(){},s}function RelayManager(){var t={_protected:{relays:[]}};return t._processInitialLoad=function(t){t&&t.relays&&(this._protected.relays=t.relays)}.$bind(t),$core._loadJSONFromUrl("data/data-relays.json",t._processInitialLoad),t.getRelayList=function(t){if(t){var e,i,s=[];for(e=0;this._protected.relays.length>e;e++)i=$system.util.clone(this._protected.relays[e]),s.push(i);t(s)}}.$bind(t),t._onswitchchange=function(t){var e,i;for(e=0;this._protected.relays.length>e;e++)if(i=this._protected.relays[e],i.board==t.data.board&&i.bank==t.data.bank){i.name=t.data.name,i.isMomentary=t.data.isMomentary,i.shown=t.data.shown,i.duration=t.data.duration,i.positiveLabel=t.data.positiveLabel,i.negativeLabel=t.data.negativeLabel;break}}.$bind(t),$ui.addEventListener("relay_switch_config_change",t._onswitchchange),t}function RemoteEvents(){var t=!0,e=function(){t&&console.log.apply(console,arguments)};this._private={events:[],failCount:0,id:"",lastSuccess:!0,FAST_RESPONSE_MS:1e3,RETRY_DELAY_MS:2e3,SIMULTANEOUS_REQUESTS:5,REGISTER_TIMEOUT_MS:1e4,LONG_POLL_TIMEOUT_MS:24e4,started:!1,failed:!1,requests:[]},this.addEventListener=function(t){if(window.chrome&&chrome.runtime&&chrome.runtime.id)return console.log("Not adding remote event listener - we are running in chrome app."),void 0;if(!this._private.failed&&-1==this._private.events.indexOf(t)){""===this._private.id&&this._private.generateId(),this._private.events.push(t);var i="/brainiac/events/addListener?id="+encodeURIComponent(this._private.id)+"&eventType="+encodeURIComponent(t),s=0,n=function(){if(this._private.failed)return e("Aborting register due to failure"),void 0;var r=$core._remoteCall(i,function(t,e){this._private.started||this._private.start(),this._private.removeRequest(e)}.$bind(this),function(i,r){if(this._private.removeRequest(r),s++,e("Attempt count:",s,t),20==s)this._private.broadcastFailure();else{var a=(new Date).getTime(),o=0;a-r.started<this._private.FAST_RESPONSE_MS&&(o=this._private.RETRY_DELAY_MS),e("Going to delay next registration attempt by",o),window.setTimeout(n,o)}}.$bind(this),5e3);this._private.requests.push(r)}.$bind(this);n()}}.$bind(this),this._private.broadcastFailure=function(){this._private.stop(),this._private.failed=!0,$ui.toast("Connection to event server broken."),e("Busted. :(")}.$bind(this),this.removeEventListener=function(){var t=this._private.events.indexOf(id);-1!=t&&(this._private.events.splice(t,1),0==this._private.events.length&&this._private.stop())}.$bind(this),this._private.start=function(){if(e("Start called"),this._private.started)return e("Already started"),void 0;this._private.started=!0;for(var t=0;this._private.SIMULTANEOUS_REQUESTS>t;++t)this._private.startRequest()}.$bind(this),this._private.startRequest=function(){if(e("Starting a request"),!this._private.started)return e("Not starting - we're already in progress..."),void 0;if(this._private.failed)return e("We have failed - not starting this request"),void 0;var t="/brainiac/events/listen?id="+encodeURIComponent(this._private.id),i=$core._remoteCall(t,this._private.success,this._private.fail,this._private.LONG_POLL_TIMEOUT_MS);this._private.requests.push(i)}.$bind(this),this._private.success=function(t,i){e("Long poll success",t),this._private.startRequest(),this._private.lastSuccess=!0,this._private.failCount=0,this._private.removeRequest(i)}.$bind(this),this._private.fail=function(t,i){if(e("Remote event fail"),this._private.removeRequest(i),this._private.lastSuccess=!1,this._private.failCount++,this._private.failCount>=20)return this._private.broadcastFailure(),void 0;var s=(new Date).getTime(),n=0;s-i.started<this._private.FAST_RESPONSE_MS&&(n=this._private.RETRY_DELAY_MS),this._private.started?window.setTimeout(this.startRequest,n):e("Not restarting - we've been stopped.")}.$bind(this),this._private.removeRequest=function(){},this._private.generateId=function(){for(var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/",e="",i=0;32>i;++i)e+=t.charAt(Math.floor(Math.random()*t.length));console.log("Generated distinct id: "+e),this._private.id=e}.$bind(this),this._private.stop=function(){this._private.started=!1;for(var t=0;this._private.requests.length>t;++t)try{e("Going to abort a request"),this._private.requests[t].request.abort()}catch(i){e(i)}}.$bind(this)}function RemotePlayerMediaSource(){var t=new PlayerMediaSource;return t._private||(t._private={}),t._private.status||(t._private.status={}),t._private.interested=[],t._private.forceStatusUpdate=!0,t._private.wrappedWebSocket=null,$core._remoteCall("/brainiac/service/mm/getLibrary",function(e){var i=!1;"media"in e&&"library"in e.media&&(t._populateLibrary(e.media.library),i=!0),i||console.log("Result: "+JSON.stringify(e))}),t.broadcastStatus=function(){var t=this._private.status;this._private.status={},this._private.processStatus(t)}.$bind(t),t._private.processStatus=function(t){if(!("song"in t&&"shuffle"in t&&"repeat"in t&&"playing"in t))return console.log("Missing fields in status."),void 0;var e=this._private.forceStatusUpdate;this._private.forceStatusUpdate=!1;var i=this._private.status;if(this._private.status=t,e||i.repeat!==t.repeat){var s=new $ui.DataEvent($system.EventType.MEDIA_REPEAT_CHANGED,t.repeat);$core.raiseEvent(s)}if(e||i.shuffle!==t.shuffle){var s=new $ui.DataEvent($system.EventType.MEDIA_SHUFFLE_CHANGED,t.shuffle);$core.raiseEvent(s)}if(e||!("song"in i)||void 0===i.song||i.song.uid!==t.song.uid){var s=new $ui.DataEvent($system.EventType.MEDIA_SONG_CHANGED,t.song);$core.raiseEvent(s)}if(e||!("playing"in i)||i.playing!==t.playing){var s=new $ui.DataEvent(t.playing?$system.EventType.MEDIA_PLAYBACK_STARTED:$system.EventType.MEDIA_PLAYBACK_ENDED);$core.raiseEvent(s)}}.$bind(t),t.playWithContext=function(t,e,i){var s="?uid="+encodeURIComponent(t);s+="&context="+encodeURIComponent(e),s+="&contextId="+encodeURIComponent(i),$core._remoteCall("/brainiac/service/mm/playWithContext"+s,this._private.processStatus)}.$bind(t),t.skipForward=function(){$core._remoteCall("/brainiac/service/mm/skip?direction=forward",this._private.processStatus)}.$bind(t),t.skipBack=function(){$core._remoteCall("/brainiac/service/mm/skip?direction=back",this._private.processStatus)}.$bind(t),t.pause=function(){$core._remoteCall("/brainiac/service/mm/pause",this._private.processStatus)}.$bind(t),t.play=function(){$core._remoteCall("/brainiac/service/mm/play",this._private.processStatus)}.$bind(t),t.isPaused=function(){if("playing"in this._private.status){var t=!this._private.status.playing;return t}return!1}.$bind(t),Object.defineProperty(t,"shuffle",{get:function(){return"shuffle"in this._private.status?this._private.status.shuffle:!1}.$bind(t)}),Object.defineProperty(t,"repeat",{get:function(){return"repeat"in this._private.status?this._private.status.repeat:0}.$bind(t)}),t.toggleShuffle=function(){$core._remoteCall("/brainiac/service/mm/shuffle",this._private.processStatus)},t.toggleRepeat=function(){$core._remoteCall("/brainiac/service/mm/repeat",this._private.processStatus)},t.getStatus=function(){$core._remoteCall("/brainiac/service/mm/getStatus",this._private.processStatus)}.$bind(t),t.registerInterest=function(t){this._private.forceStatusUpdate=!0;for(var e=0;this._private.interested.length>e;++e)if(this._private.interested[e]===t)return console.log("Object already registered.",t),this._private.wrappedWebSocket.send("ping"),void 0;this._private.interested.push(t),1===this._private.interested.length&&(this._private.wrappedWebSocket=$system.util.wrapWebSocket("/brainiac/service/mm"),this._private.wrappedWebSocket.onmessage=this._private.processStatus,this._private.wrappedWebSocket.start())}.$bind(t),t.unregisterInterest=function(t){if(console.log("Unregister interest"),0!==this._private.interested.length){for(var e=0;this._private.interested.length>e;++e)this._private.interested[e]===t&&(this._private.interested.splice(e,1),--e);0===this._private.interested.length&&this._private.wrappedWebSocket.stop()}}.$bind(t),[$system.EventType.MEDIA_SONG_CHANGED,$system.MEDIA_REPEAT_CHANGED,$system.MEDIA_SHUFFLE_CHANGED,$system.MEDIA_PLAYBACK_STARTED,$system.MEDIA_PLAYBACK_ENDED],t}function SuspensionManager(){var t={_protected:{lf:20,rf:20,lr:45,rr:47,tank:112,accessories:[],requestInterval:null,requestsInProgress:0,valveMap:{addAir:{lf:"80",rf:"20",lr:"8",rr:"2"},releaseAir:{lf:"40",rf:"10",lr:"4",rr:"1"}}}};t.choosePreset=function(t){"number"==typeof t&&this._protected.accessories.length>0&&$system.accessoryManager.sendCommandToAccessory(this._protected.accessories[0],"s "+t)}.$bind(t),t.requestCurrentData=function(){window.$core&&(this._protected.accessories.length>0?(this._protected.requestsInProgress++,$system.accessoryManager.sendCommandToAccessory(this._protected.accessories[0],"g",this._protected.onPressureGet,this._protected.onPressureFail)):this._protected.firePressureEvent())}.$bind(t),t._protected.firePressureEvent=function(){if(window.$core){var t={lf:this._protected.lf,rf:this._protected.rf,lr:this._protected.lr,rr:this._protected.rr,tank:this._protected.tank},e=new $ui.DataEvent($system.EventType.ONSUSPENSIONDATA,t);$core.raiseEvent(e)}}.$bind(t),t._protected.onPressureGet=function(t){this._protected.requestsInProgress--;var e=!0;if(t&&"response"in t&&"result"in t&&1==t.result){var i=t.response.split("\n");if(2>i.length||"g"!=i[0])console.log("Unexpected response from accessory.");else try{console.log("Pressure coming from: "+i[1]);var s=JSON.parse(i[1]);Array.isArray(s)&&5==s.length&&(this._protected.lf=s[0],this._protected.rf=s[1],this._protected.lr=s[2],this._protected.rr=s[3],this._protected.tank=s[4],e=!1)}catch(n){console.log(n)}}e?this._protected.clearPressures():(0==this._protected.requestsInProgress?window.setTimeout(this.requestCurrentData,250):console.log("Not starting another request, there are already: "+this._protected.requestsInProgress),this._protected.firePressureEvent())}.$bind(t),t._protected.onPressureFail=function(t){t&&console.log("Need to handle what to do when getting no pressures back - from the timeout..."),this._protected.clearPressures()}.$bind(t),t._protected.clearPressures=function(){this._protected.lf=0,this._protected.rf=0,this._protected.lr=0,this._protected.rr=0,this._protected.tank=0,this._protected.firePressureEvent()}.$bind(t),t.releaseAir=function(t){if("lf"==t||"rf"==t||"lr"==t||"rr"==t)if(0!=this._protected.accessories.length)$system.accessoryManager.sendCommandToAccessory(this._protected.accessories[0],"v "+this._protected.valveMap.releaseAir[t]);else{var e=this._protected[t];e-=4,0>e&&(e=0),this._protected[t]=e,this.requestCurrentData()}}.$bind(t),t.closeValve=function(t){("lf"==t||"rf"==t||"lr"==t||"rr"==t)&&0!=this._protected.accessories.length&&$system.accessoryManager.sendCommandToAccessory(this._protected.accessories[0],"v 0")}.$bind(t),t.addAir=function(t){if("lf"==t||"rf"==t||"lr"==t||"rr"==t)if(0!=this._protected.accessories.length)$system.accessoryManager.sendCommandToAccessory(this._protected.accessories[0],"v "+this._protected.valveMap.addAir[t]);else{var e=this._protected[t];e+=4,this._protected[t]=e,this.requestCurrentData()}}.$bind(t),t._protected.accessoriesFound=function(t){t&&0!=t.length?(this._protected.onPressureFail(),this._protected.accessories=t):this._protected.accessories=[],this.requestCurrentData()}.$bind(t);var e=$system.accessoryManager.getConnectedAccessories("suspension");return e&&0!=e.length?t._protected.accessoriesFound(e):$system.accessoryManager.updateConnectedAccessories(function(){t._protected.accessoriesFound($system.accessoryManager.getConnectedAccessories("suspension"))}),t}var $system={version:{major:1,minor:0,revision:0,build:1},_apps:[],config:{theme:{},celsius:!1,isEmulator:!1},init:function(t){this.isClientDevice=t&&1==t.isClientDevice?!0:!1,this.config.theme=void 0==t.theme?{}:t.theme,this.config.celsius=void 0!=t.celsius?t.celsius:this.config.celsius,this.config.isEmulator=void 0!=t.isEmulator?t.isEmulator:this.config.isEmulator,this.config.isClientDevice=void 0!=t.isClientDevice?t.isClientDevice:this.config.isClientDevice,this.audio=new AudioManager(this.isClientDevice),this.contacts=new ContactsManager,this.phone=new PhoneManager,this.relays=new RelayManager,this.suspension=new SuspensionManager},isCelsius:function(){return this.config.celsius},registerApp:function(t,e){this._apps.push({id:t,instance:e})},unregisterApp:function(t){var e,i;for(e=0;this._apps.length>e;e++)if(i=this._apps[e],i.id==t)return this._apps.splice(e,1),i.id=void 0,i.instance=void 0,void 0},initiateCall:function(t){$ui.push(activeCall,t)}};$system.Color={TURQUOISE:"#1ABC9C",GREEN_SEA:"#16A085",EMERALD:"#2ECC71",NEPHRITIS:"#27AE60",PETER_RIVER:"#3498DB",BELIZE_HOLE:"#2980B9",WET_ASPHAULT:"#34495E",MIDNIGHT_BLUE:"#2C3E50",PINK:"#FAABEC",AMETHYST:"#AF7AC4",WISTERIA:"#8E44AD",SUN_FLOWER:"#F1C40F",ORANGE:"#F39C12",CARROT:"#E67E22",PUMPKIN:"#D35400",ALIZARIN:"#D94646",POMEGRANATE:"#C0392B",SILVER:"#BDC3C7",CONCRETE:"#AAB7B7",ASBESTOS:"#98A3A3"},$system.accessoryManager=function(){function t(t,e,i){$core._remoteCall("/brainiac/service/hardware/acc/"+t,e,i)}var e={_private:{}};return e._private.accessories=[],e.getConnectedAccessories=function(t){if("string"==typeof t){for(var e=[],i=0;this._private.accessories.length>i;++i){var s=this._private.accessories[i];s.family===t&&e.push($system.util.clone(s))}return e}return $system.util.clone(this._private.accessories)}.$bind(e),e.sendCommandToAccessory=function(e,i,s,n){var r="";if("string"==typeof e)r=e;else{if(!("serialNumber"in e))return console.log("There was no serial number in the accesory object"),void 0;r=e.serialNumber}if("string"!=typeof r||""===r)return console.log("Serial number is not usable: "+r),void 0;if("string"!=typeof i)return console.log("Command is not a string"),void 0;var a="command?";a+="serialNumber="+encodeURIComponent(r),a+="&",a+="command="+encodeURIComponent(i),t(a,s,n)}.$bind(e),e.updateConnectedAccessories=function(i){t("list",function(t){"accessories"in t?(e._private.accessories=t.accessories,"function"==typeof i&&i($system.util.clone(t.accessories))):(console.log("Problem updating accessories - telling caller about our old (possibly stale) ones: "+JSON.stringify(t)),"function"==typeof i&&i($system.util.clone(e._private.accessories)))},function(t){console.log("Problem updating accessories: "+t),"function"==typeof i&&i($system.util.clone(e._private.accessories))})}.$bind(e),e}(),$system.Album={},$system.bossError=function(){function t(){}return new t}(),$system.CallLogEntry={},$system.CallLogEntryType={INCOMING:0,OUTGOING:1,MISSED:2},$system.Contact={},$system.EventType={ONSPEEDCHANGE:"onspeedchange",ONFUELCHANGE:"onfuelchange",ONRPMCHANGE:"onrpmchange",ONDRIVERTEMPCHANGE:"ondrivertempchange",ONPASSENGERTEMPCHANGE:"onpassengertempchange",MEDIA_SONG_CHANGED:"mediaSongChanged",MEDIA_REPEAT_CHANGED:"mediaRepeatChanged",MEDIA_SHUFFLE_CHANGED:"mediaShuffleChanged",MEDIA_PLAYBACK_STARTED:"mediaPlaybackStarted",MEDIA_PLAYBACK_ENDED:"mediaPlaybackEnded",EVENT_CONNECTION_FAILURE:"eventConnectionFailure",ONREQUESTSUSPENSIONUI:"onrequestsuspensionui",ONSUSPENSIONDATA:"onsuspensiondata"},$system.hvac=new function(){this._private={fanDirection:{face:!1,feet:!0,frontDemist:!0,rearDemist:!1,ac:!1,recirc:!1,enabled:!0},fanSpeed:.5},this._private.validateDirection=function(t){for(var e in this._private.fanDirection)if(!(e in t)||t[e]!==!0&&t[e]!==!1)return!1;return!0}.$bind(this),this._private.directionEquals=function(t,e){for(var i in this._private.fanDirection)if(!(i in t&&i in e&&t[i]===e[i]))return!1;return!0}.$bind(this),this._private.copyDirection=function(t,e){for(var i in this._private.fanDirection)e[i]=t[i]}.$bind(this),Object.defineProperty(this,"fanDirection",{get:function(){var t={};return this._private.copyDirection(this._private.fanDirection,t),t},set:function(t){if(this._private.validateDirection(t))if(this._private.directionEquals(this._private.fanDirection,t));else{this._private.copyDirection(t,this._private.fanDirection);var e={};this._private.copyDirection(t,e);var i=new $ui.DataEvent("onfandirectionchanged",{fanDirection:e});$ui.raiseEvent(i)}else console.log("WARNING: Not a valid fan direction")
}.$bind(this)}),Object.defineProperty(this,"fanSpeed",{get:function(){return this._private.fanSpeed},set:function(t){if("number"==typeof t)if(-1==t||t>=0&&1>=t){t!=this._private.fanSpeed&&(this._private.fanSpeed=t);var e=new $ui.DataEvent("onfanspeedchanged",{fanSpeed:t});$ui.raiseEvent(e)}else console.log("WARNING: fan speed out of range");else console.log("WARNING: fan speed must be a number")}})},$system.MediaSource={getCurrentSong:function(){}},$system.MediaSourceType={PLAYER:0,AMFM:1,XM:2},$system.obd=function(){function t(){}function e(t,e,i){$core._remoteCall("/brainiac/service/hardware/obd/"+t,e,i)}function i(t){return function(e){if("obd"in e){var i=e.obd;"response"in i&&(i.responseBytes=s(i.response))}null==t?console.log("Wrapped response: "+JSON.stringify(e)):t(e)}}function s(t){var e=t.lastIndexOf("\r");-1!=e&&(t=t.substring(e+1));for(var i=[],s=0,n=0,r=0;t.length>r;++r){s<<=4;var a=t.charCodeAt(r);a>=48&&57>=a?(s|=a-48,++n):a>=65&&70>=a?(s|=a-65+10,++n):a>=97&&102>=a&&(s|=a-97+10,++n),2==n&&(i.push(s),n=0,s=0)}return i}return t.prototype.getDTC=function(t,i){e("getDTC",t,i)},t.prototype.getTestStatus=function(t,i){e("getTestStatus",t,i)},t.prototype.sendPID=function(t,s,n,r){try{t=parseInt(t),s=parseInt(s),e("sendPID?mode="+t+"&pid="+s,i(n),r)}catch(a){null!=r?r(a):console.log("Error setting up remote call "+a)}},t.prototype.getOBDStatus=function(t,i){e("getOBDStatus",t,i)},t.prototype.clearDTC=function(t,s){e("clearDTC",i(t),s)},new t}(),$system.PhoneNumber={},$system.PhoneNumberType={HOME:0,WORK:1,MOBILE:2,OTHER:3},$system.property=function(){function t(){}return t.prototype.get=function(t,e,i){var s=null,n=null;if("function"==typeof e?s=e:"function"==typeof i&&(s=i),null!=e&&"object"==typeof e?n=e:null!=i&&"object"==typeof i&&(n=i),window.chrome&&chrome.storage&&chrome.storage.local)chrome.storage.local.get(t,function(t){s(t)});else{var r="brainiac/service/data/get";r+="?names="+encodeURIComponent(JSON.stringify(t)),n&&(r+="&defaultValues="+encodeURIComponent(JSON.stringify(n))),s&&"function"==typeof s?$core._remoteCall(r,function(t){t&&"values"in t&&s(t.values)}):console.log("No callback given to async get function.")}},t.prototype.set=function(t,e){window.chrome&&chrome.storage&&chrome.storage.local?(chrome.storage.local.set(t),e&&"function"==typeof e&&window.setTimeout(function(){e(t)},0)):$core._remoteCall("brainiac/service/data/set?values="+encodeURIComponent(JSON.stringify(t)),function(t){t&&"values"in t&&"function"==typeof e&&e(t.values)})},new t}(),$system.Relay={},$system.remoteEvents=new RemoteEvents,$system.Song={},$system.SoundEffect={BLIP:0,HORN:1,TOUCH:2,TONE0:3,TONE1:4,TONE2:5,TONE3:6,TONE4:7,TONE5:8,TONE6:9,TONE7:10,TONE8:11,TONE9:12,TONE_POUND:13,TONE_ASTERIK:14},$system.util=function(){function t(){function t(e,i){var s;if(null==e)return null;if(i>10)throw"Cloning too deep: "+i;if(e instanceof Function)return e;if(e instanceof Array){s=[];for(var n=0;e.length>n;++n)s[n]=t(e[n],i+1);return s}if(e instanceof Object){s={};for(var r in e)s[r]=t(e[r],i+1);return s}return e}this.clone=function(e){return t(e,0)},this.converter={},this.converter.secondsToTime=function(t){if(null==t)return"";"number"!=typeof t&&(t=parseInt(t)),t=Math.round(t);var e=Math.floor(t/3600);t%=3600;var i=Math.floor(t/60);t%=60;var s="";return 0!==e&&(s+=e,s+=":",10>i&&(s+="0")),s+=i,s+=":",10>t&&(s+="0"),s+=t},this.degreesCtoF=function(t){return Math.round(9*t/5+32)},this.degreesFtoC=function(t){return Math.round(5*(t-32)/9)},this.callCallback=function(t){if("function"==typeof t)try{t.apply(null,Array.prototype.slice.call(arguments,1))}catch(e){console.log("Caught problem in callback;"),console.log(e)}},this.wrapWebSocket=function(t){function e(t){console.log("Web socket error: TODO - try and connect again?"),f=null,++p,20>p&&_(),y.onerror(t)}function i(){console.log("Web socket closed: TODO - try and connect again?"),v||(h>1?_():setTimeout(_,5e3)),y.onclose()}function s(){y.onopen()}function n(t){if(h++,t&&"data"in t){var e=t.data,i=JSON.parse(e);y.onmessage(i)}else console.log("No data in websocket message")}var r=window.location.protocol,a="ws://";if("http:"===r);else{if("https:"!==r)return console.log("Returning a dummy wrapped web socket - could not determine protocol"),{};a="wss://"}var o=window.location.host,u=o.split(":");if(2!=u.length)return console.log("Returning a dummy wrapped web socket - could not determine a port"),{};var c=-1;try{c=parseInt(u[u.length-1]),c-=50}catch(l){return console.log("Returning a dummy wrapped web socket - could not parse port"),{}}o=u[0];var d=a+o+":"+c+"/"+t.replace(/^\/*/,""),p=0,h=0,f=null,v=!1,_=function(){v||(h=0,console.log("Using URL: ",d),f=new WebSocket(d),f.onerror=e,f.onopen=s,f.onclose=i,f.onmessage=n)}.$bind(y),y={};return y.start=function(){_()}.$bind(y),y.stop=function(){console.log("Stopping web socket"),v=!0,null!=f&&f.close(),f=null}.$bind(y),y.onmessage=function(t){console.log("User has not set onmessage",t)}.$bind(y),y.onerror=function(t){console.log("Error with web socket",t)},y.onopen=function(){},y.onclose=function(){},y.send=function(t){null!=f&&f.send(t)},y}}return new t}();