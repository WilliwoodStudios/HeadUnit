/* [Copyright (c) 2015 Workshop 12 Inc.] $core VERSION: 1.0.0.1119*/

var $core={version:{major:1,minor:0,revision:0,build:1},_debugUrlPrefix:"",raiseEvent:function(e){if(void 0!=window.$system){var o,s;for(o=0;$system._apps.length>o;o++)s=$system._apps[o],s.instance&&s.instance.raiseEvent(e)}},updateTheme:function(e){if(void 0!=window.$system&&void 0!=e){var o,s;for(o=0;$system._apps.length>o;o++)s=$system._apps[o],s.instance&&(s.instance.theme=e);$system.config.theme=e,$system.property&&$system.property.set({core_theme:e})}},getBackgroundImage:function(e){var o;switch(e){case $system.Color.TURQUOISE:o="turquoise";break;case $system.Color.EMERALD:o="emerald";break;case $system.Color.PETER_RIVER:o="peter.river";break;case $system.Color.AMETHYST:o="amethyst";break;case $system.Color.WET_ASPHAULT:o="wet.asphault";break;case $system.Color.GREEN_SEA:o="green.sea";break;case $system.Color.NEPHRITIS:o="nephritis";break;case $system.Color.PINK:o="pink";break;case $system.Color.BELIZE_HOLE:o="belize.hole";break;case $system.Color.WISTERIA:o="wisteria";break;case $system.Color.MIDNIGHT_BLUE:o="midnight.blue";break;case $system.Color.SUN_FLOWER:o="sun.flower";break;case $system.Color.CARROT:o="carrot";break;case $system.Color.ALIZARIN:o="alizarin";break;case $system.Color.CONCRETE:o="concrete";break;case $system.Color.ORANGE:o="orange";break;case $system.Color.PUMPKIN:o="pumpkin";break;case $system.Color.POMEGRANATE:o="pomegranate";break;case $system.Color.SILVER:o="silver";break;case $system.Color.ASBESTOS:o="asbestos"}return o?"img/background."+o+".png":void 0},_loadJSONFromUrl:function(e,o){var s=new XMLHttpRequest;s.callback=o,s.onreadystatechange=function(){if(4==this.readyState&&200==this.status){try{var e=JSON.parse(this.responseText)}catch(o){return console.log("$emulator.loadJSONFromUrl: "+o),void 0}this.callback(e)}},s.open("GET",e,!0);try{s.send()}catch(t){console.log(t)}},_remoteCall:function(e,o,s,t){if(window.chrome&&chrome.runtime&&chrome.runtime.id){var r={error:"Running as a chrome app"};return s?setTimeout(function(){s(r)},0):o&&setTimeout(function(){o(r)},0),void 0}var n=new XMLHttpRequest,a=!1,i=null,l={request:n,started:(new Date).getTime()};n.onreadystatechange=function(){if(!a&&4==n.readyState){i&&(window.clearTimeout(i),i=null);var e=n.status,t=null;200!=e&&(t=n.status+" "+n.statusText);var r=n.responseText,c=r;try{if(r.length>0){var p=r.charAt(0);("["==p||"{"==p||'"'==p)&&(c=JSON.parse(r),null!=s&&"error"in c&&(t=c.error))}}catch(u){console.log("Possibly bad JSON from server "+r+" "+u)}null!=t?(console.log("On error is: "+s),null!=s?s(t,l):console.log("Error from server: "+JSON.stringify(t))):null!=o?o(c,l):console.log("Response from server: "+JSON.stringify(c))}};try{return n.open("GET",this._debugUrlPrefix+e,!0),n.send(),t&&(console.log("Setting timeout"),i=window.setTimeout(function(){console.log("Ready state: "+n.readyState),console.log("Timeout fired"),4!=n.readyState?(console.log("Timing out request"),n.abort(),a=!0,null!=s&&s({error:"Timedout"},l)):console.log("Request already finished.")},t)),l}catch(c){null!=s?s(r,l):console.log("Error with connection "+r)}return void 0},openSettings:function(){$core.getAppsList(function(e){var o,s;if(void 0!=e)for(o=0;e.length>o;o++)if(s=e[o],"core.settings"==s.id){$core.openApp(s);break}})},openApp:function(e,o){if(0!=$ui.screens.length){var s=$ui.screens[0],t=function(){this.component=$ui.AppContainer},r="apps/"+e.id+"/";t.prototype.src=r+e.content,t.prototype._appId=e.id,void 0!=e.icon&&(t.prototype.icon=r+e.icon),e.iconSplash&&(t.prototype.iconSplash=r+e.iconSplash),void 0==o?s.primaryWindow.push(t):o.push(t)}},getAppsList:function(e){this._loadJSONFromUrl("data/data-installed-aps.json",function(o){var s=[];o&&o.apps&&(s=o.apps),e(s)})}};